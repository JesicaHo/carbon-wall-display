<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>æ ¡åœ’æ¸›ç¢³å¤§ä½œæˆ°ï½œæ•¸å€¼èˆ‡å–®ä½ç¨ç«‹å®šä½ + å…¨è¢å¹• + å¾®èª¿</title>
<style>
:root{
  /* éœ€è¦ç¸®æ”¾å†æ”¹é€™è£¡ï¼š0.80 ~ 0.90 éƒ½å¯ï¼Œä¸å½±éŸ¿åº§æ¨™ */
  --scale: 0.85;

  /* ç¬¬ä¸€åˆ— */
  --foodV-top: 37.82%;  --foodV-left: 29.36%;
  --foodU-top: 42.93%;  --foodU-left: 41.29%;
  --transportV-top: 38.09%; --transportV-left: 70.74%;
  --transportU-top: 43.04%; --transportU-left: 81.83%;

  /* ç¬¬äºŒåˆ— */
  --plasticV-top: 56.60%; --plasticV-left: 30.76%;
  --plasticU-top: 61.71%; --plasticU-left: 40.54%;
  --moveV-top: 57.08%;    --moveV-left: 71.67%;
  --moveU-top: 61.92%;    --moveU-left: 83.13%;

  /* ç¬¬ä¸‰åˆ— */
  --peopleV-top: 84.53%;  --peopleV-left: 25.63%;
  --peopleU-top: 89.69%;  --peopleU-left: 38.21%;
  --totalV-top: 83.78%;   --totalV-left: 71.76%;
  --totalU-top: 89.69%;   --totalU-left: 84.72%;
}


html, body{
  margin:0; height:100%;
  font-family:"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
  background:#000; color:#111;
}
.stage{
  position:relative;
  width:calc(100vw/var(--scale));
  height:calc(100vh/var(--scale));
  transform:scale(var(--scale));
  transform-origin:top left;
  background:url("./é›»è¦–ç‰†_é›»è¦–ç‰†2.jpg") center/cover no-repeat;
  overflow:hidden;
}

/* ===== å…©ç¨®å…ƒç´ ï¼š.valï¼ˆæ•¸å€¼ï¼‰èˆ‡ .unit-blockï¼ˆå–®ä½ï¼‰ ===== */
.val, .unit-block{
  position:absolute;
  transform:translate(-50%,-50%);  /* ä»¥ä¸­å¿ƒå°æº–åº§æ¨™ */
  pointer-events:none;              /* å¾®èª¿æ¨¡å¼æœƒæ‰“é–‹ */
  text-shadow:0 1px 2px rgba(0,0,0,.15);
  font-weight:800; letter-spacing:1px;
}

/* æ•¸å€¼æ¨£å¼ï¼ˆå¯ä¾å€å¡Šä¸Šè‰²ï¼‰ */
.val{ font-size:3.2vh; color:#0b1b2b; }
#foodV{ color:#0a48b3; }      #transportV{ color:#0a8b4a; }
#plasticV{ color:#c0392b; }   #moveV{ color:#e67e22; }
#peopleV{ color:#ffffff; }    #totalV{ color:#ffffff; }

/* å–®ä½æ¨£å¼ï¼ˆç•¥å°ï¼‰ */
.unit-block{ font-size:2.0vh; opacity:.85; color:#0b1b2b; }
#peopleU{ color:#ffffff; }    #totalU{ color:#ffffff; }

/* ä½ç½®ç¶å®šåˆ° CSS è®Šæ•¸ */
#foodV     { top:var(--foodV-top);     left:var(--foodV-left); }
#foodU     { top:var(--foodU-top);     left:var(--foodU-left); }
#transportV{ top:var(--transportV-top);left:var(--transportV-left); }
#transportU{ top:var(--transportU-top);left:var(--transportU-left); }
#plasticV  { top:var(--plasticV-top);  left:var(--plasticV-left); }
#plasticU  { top:var(--plasticU-top);  left:var(--plasticU-left); }
#moveV     { top:var(--moveV-top);     left:var(--moveV-left); }
#moveU     { top:var(--moveU-top);     left:var(--moveU-left); }
#peopleV   { top:var(--peopleV-top);   left:var(--peopleV-left); }
#peopleU   { top:var(--peopleU-top);   left:var(--peopleU-left); }
#totalV    { top:var(--totalV-top);    left:var(--totalV-left); }
#totalU    { top:var(--totalU-top);    left:var(--totalU-left); }

/* ç‹€æ…‹èˆ‡å…¨è¢å¹•æŒ‰éˆ• */
#status{
  position:fixed; left:12px; bottom:12px;
  background:rgba(255,255,255,.85);
  padding:6px 10px; border-radius:8px; font-size:14px; color:#111;
}
#fsBtn{
  position:fixed; right:14px; bottom:14px; z-index:10;
  border:0; border-radius:10px; padding:10px 14px;
  font-size:14px; font-weight:700; background:#0a7cff; color:#fff; cursor:pointer;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}
#fsBtn.hide{ display:none; }

/* é˜²ç‡’å°æ¥µå°å¿ƒè·³ */
@keyframes tinyPulse{ 0%,97%,100%{opacity:1} 98.5%{opacity:.98} }
.stage{ animation: tinyPulse 300s linear infinite; }
</style>
</head>
<body>

<div class="stage" id="stage">
  <!-- ç¬¬ä¸€åˆ—ï¼šé£²é£Ÿ / äº¤é€š -->
  <div id="foodV" class="val"><span id="v-food">--</span></div>
  <div id="foodU" class="unit-block">kgCOâ‚‚e</div>

  <div id="transportV" class="val"><span id="v-transport">--</span></div>
  <div id="transportU" class="unit-block">kgCOâ‚‚e</div>

  <!-- ç¬¬äºŒåˆ—ï¼šæ¸›å¡‘ / ç§»å‹• -->
  <div id="plasticV" class="val"><span id="v-plastic">--</span></div>
  <div id="plasticU" class="unit-block">kgCOâ‚‚e</div>

  <div id="moveV" class="val"><span id="v-move">--</span></div>
  <div id="moveU" class="unit-block">kgCOâ‚‚e</div>

  <!-- ç¬¬ä¸‰åˆ—ï¼šäººæ¬¡ / ç¸½æ¸›ç¢³ -->
  <div id="peopleV" class="val"><span id="v-people">--</span></div>
  <div id="peopleU" class="unit-block">äººæ¬¡</div>

  <div id="totalV" class="val"><span id="v-total">--</span></div>
  <div id="totalU" class="unit-block">kgCOâ‚‚e</div>
</div>

<button id="fsBtn" title="Fï¼šå…¨è¢å¹•">é€²å…¥å…¨è¢å¹•</button>
<div id="status">åˆå§‹åŒ–ä¸­â€¦ï¼ˆF å…¨è¢å¹• / E å¾®èª¿ / S è¤‡è£½åº§æ¨™ï¼‰</div>

<script>
/* === åŸºæœ¬è¨­å®š === */
const API_EXEC = "https://script.google.com/macros/s/AKfycby7d9Zoo-JCCojFWN6aG10N8v5PYyTs3pjTReAGiuwU3aJoQUkBxU_2-0EBPdziMQcN/exec";
const REFRESH_MS = 30000;
const nf = new Intl.NumberFormat('zh-Hant-TW',{ maximumFractionDigits:2 });
const $ = (id) => document.getElementById(id);
const st = (t) => $("status").textContent = t;

/* === JSONP è®€å– === */
function show(m){
  $("v-food").textContent = nf.format(m.food);
  $("v-transport").textContent = nf.format(m.transport);
  $("v-plastic").textContent = nf.format(m.plastic);
  $("v-move").textContent = nf.format(m.move);
  $("v-people").textContent = nf.format(m.people);
  $("v-total").textContent = nf.format(m.total);
}
function onData(payload){
  try{
    if(!payload || !payload.ok) throw new Error(payload?.error || "API å›å‚³ä¸æ­£ç¢º");
    show(payload.data);
    st("âœ… æˆåŠŸè¼‰å…¥ï¼ˆ"+ payload.data.updatedAt +"ï¼‰â€” F å…¨è¢å¹• / E å¾®èª¿ / S è¤‡è£½åº§æ¨™");
  }catch(e){ st("âŒ è§£æå¤±æ•—ï¼š"+ e.message); }
}
function loadOnce(){
  const s = document.createElement("script");
  s.src = API_EXEC + "?callback=onData&_ts=" + Date.now();
  s.onerror = () => st("âŒ è¼‰å…¥å¤±æ•—ï¼šè«‹æª¢æŸ¥éƒ¨ç½²æˆ–æ¬Šé™");
  document.body.appendChild(s);
}
loadOnce(); setInterval(loadOnce, REFRESH_MS);

/* === å…¨è¢å¹•ï¼ˆF åˆ‡æ›ï¼‰ === */
async function enterFS(){ try{
  const el=document.documentElement;
  if(!document.fullscreenElement && el.requestFullscreen){ await el.requestFullscreen(); $("fsBtn").classList.add("hide"); }
}catch{} }
async function exitFS(){ try{ if(document.fullscreenElement) await document.exitFullscreen(); }catch{} }
$("fsBtn").addEventListener("click", enterFS);
document.addEventListener("keydown", e=>{ const k=e.key.toLowerCase(); if(k==="f"){ document.fullscreenElement?exitFS():enterFS(); } });

/* === é˜²ä¼‘çœ  === */
let wakeTimer=null;
function keepAwake(){
  clearInterval(wakeTimer);
  wakeTimer = setInterval(()=>{ document.title=" "; setTimeout(()=>document.title="æ ¡åœ’æ¸›ç¢³å¤§ä½œæˆ°",80); },120000);
}
keepAwake(); document.addEventListener("visibilitychange", ()=>{ if(document.visibilityState==="visible") keepAwake(); });

/* === å¾®èª¿æ¨¡å¼ï¼ˆE é–‹/é—œã€S è¤‡è£½ã€æ‹–æ›³ã€æ–¹å‘éµå¾®ç§»ï¼‰ === */
let tune=false, active=null, current=null;
/* å¯ç¨ç«‹èª¿æ•´çš„ IDï¼šæ¯å€‹æ•¸å€¼ V èˆ‡å–®ä½ U éƒ½åˆ—é€²ä¾† */
const ids=["foodV","foodU","transportV","transportU","plasticV","plasticU","moveV","moveU","peopleV","peopleU","totalV","totalU"];

function setDraggable(ok){
  ids.forEach(id=>{ const el=$(id); el.style.pointerEvents = ok ? "auto" : "none"; el.style.cursor = ok ? "move" : "default"; });
  st(ok ? "ğŸ›  å¾®èª¿æ¨¡å¼ï¼šæ‹–æ›³ / æ–¹å‘éµï¼ˆShiftÃ—2.5ï¼‰ / S è¤‡è£½åº§æ¨™ / E é€€å‡º"
        : "âœ… æˆåŠŸè¼‰å…¥â€”F å…¨è¢å¹• / E å¾®èª¿ / S è¤‡è£½åº§æ¨™");
}
document.addEventListener("keydown", e=>{
  const k=e.key.toLowerCase();
  if(k==="e"){ tune=!tune; setDraggable(tune); }
  if(k==="s" && tune){
    const g=getComputedStyle(document.documentElement);
    const vars = ids.map(id=>{
      const top=g.getPropertyValue(`--${id}-top`).trim();
      const left=g.getPropertyValue(`--${id}-left`).trim();
      return `--${id}-top: ${top}; --${id}-left: ${left};`;
    }).join("\n");
    navigator.clipboard.writeText(vars);
    alert("å·²è¤‡è£½åº§æ¨™ï¼š\n\n"+vars+"\n\nè²¼å› :root å³å¯æ°¸ä¹…å›ºå®šã€‚");
  }
});
ids.forEach(id=>{
  const el=$(id);
  el.addEventListener("pointerdown", e=>{ if(!tune) return; active=el; current=id; el.setPointerCapture(e.pointerId); });
  el.addEventListener("pointermove", e=>{
    if(!tune || active!==el) return;
    const r=$("stage").getBoundingClientRect();
    const x=((e.clientX-r.left)/r.width)*100;
    const y=((e.clientY-r.top)/r.height)*100;
    document.documentElement.style.setProperty(`--${id}-left`, x.toFixed(2)+"%");
    document.documentElement.style.setProperty(`--${id}-top`,  y.toFixed(2)+"%");
  });
  el.addEventListener("pointerup", ()=>{ active=null; });
});
document.addEventListener("keydown", e=>{
  if(!tune || !current) return;
  const step = e.shiftKey ? 0.5 : 0.2;
  const g=getComputedStyle(document.documentElement);
  const rd=k=>parseFloat(g.getPropertyValue(k))||0;
  if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key)){
    e.preventDefault();
    let t=rd(`--${current}-top`), l=rd(`--${current}-left`);
    if(e.key==="ArrowLeft") l-=step;
    if(e.key==="ArrowRight") l+=step;
    if(e.key==="ArrowUp") t-=step;
    if(e.key==="ArrowDown") t+=step;
    document.documentElement.style.setProperty(`--${current}-top`,  t.toFixed(2)+"%");
    document.documentElement.style.setProperty(`--${current}-left`, l.toFixed(2)+"%");
  }
});
</script>
</body>
</html>
